openapi: 3.0.0
info:
  title: Bank Cards API
  description: API для управления банковскими картами и пользователями
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Локальный сервер разработки

paths:
  /api/cards:
    get:
      summary: Получить список всех карт
      description: Возвращает список всех карт, доступных пользователю или администратору.
      responses:
        '200':
          description: Успешный запрос
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'
    post:
      summary: Создать новую карту
      description: Создает новую карту. Доступно только администратору.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardDTO'
      responses:
        '200':
          description: Успешное создание карты
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'

  /api/cards/{id}:
    get:
      summary: Получить карту по ID
      description: Возвращает карту по указанному ID. Доступно пользователю или администратору.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Успешный запрос
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
    put:
      summary: Обновить карту по ID
      description: Обновляет карту по указанному ID. Доступно только администратору.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardDTO'
      responses:
        '200':
          description: Успешное обновление карты
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
    delete:
      summary: Удалить карту по ID
      description: Удаляет карту по указанному ID. Доступно только администратору.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Карта успешно удалена

  /api/cards/transfer:
    post:
      summary: Перевод между картами
      description: Выполняет перевод средств между картами. Доступно пользователю.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferRequest'
      responses:
        '200':
          description: Успешный перевод

  /api/auth/login:
    post:
      summary: Аутентификация пользователя
      description: Аутентифицирует пользователя и возвращает JWT токен.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Успешная аутентификация
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JwtAuthenticationResponse'

  /api/auth/register:
    post:
      summary: Регистрация пользователя
      description: Регистрирует нового пользователя.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
      responses:
        '200':
          description: Успешная регистрация
          content:
            application/json:
              schema:
                type: string
                example: "User registered successfully"

components:
  schemas:
    Card:
      type: object
      properties:
        id:
          type: integer
          format: int64
        number:
          type: string
          description: Номер карты (замаскированный)
        owner:
          type: string
          description: Владелец карты
        expiryDate:
          type: string
          format: date
          description: Дата истечения срока действия
        status:
          type: string
          enum: [ACTIVE, BLOCKED, EXPIRED]
          description: Статус карты
        balance:
          type: number
          format: double
          description: Баланс карты
        user:
          $ref: '#/components/schemas/User'

    CardDTO:
      type: object
      properties:
        cardNumber:
          type: string
          pattern: ^[0-9]{16}$
          description: Номер карты (16 цифр)
        owner:
          type: string
          description: Владелец карты
        expiryDate:
          type: string
          pattern: ^(0[1-9]|1[0-2])/[0-9]{2}$
          description: Дата истечения срока действия (MM/YY)
        status:
          type: string
          description: Статус карты
        balance:
          type: number
          format: double
          description: Баланс карты

    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        password:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        role:
          type: string
        cards:
          type: array
          items:
            $ref: '#/components/schemas/Card'

    UserDTO:
      type: object
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 20
        password:
          type: string
          minLength: 6
          maxLength: 40
        email:
          type: string
        role:
          type: string

    Role:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
          enum: [ADMIN, USER]

    TransferRequest:
      type: object
      properties:
        sourceCardNumber:
          type: string
        destinationCardNumber:
          type: string
        amount:
          type: number
          format: double
          minimum: 0

    LoginRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string

    SignUpRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        role:
          type: string

    JwtAuthenticationResponse:
      type: object
      properties:
        accessToken:
          type: string
